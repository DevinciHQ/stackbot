ahoyapi: v2
usage: Commands for running and updating stackbot
commands:
  up:
    usage: run stackbot locally.
    cmd: |
      ahoy frontend-build-watch &
      dev_appserver.py --skip_sdk_update_check=true default backend
  pip-install:
    usage: python pip, but locally vendored.
    cmd: cd backend && pip install -t lib {{args}}
  console:
    usage: open the app engine web python console.
    cmd: open 'http://localhost:8000/console'
  deploy:
    usage: deploy the app to google app engine
    cmd: |
      set -e
      ahoy frontend-build
      appcfg.py -A devinci-stackbot -V {{args}} update default
      appcfg.py -A devinci-stackbot -V {{args}} update backend
  deps-frontend:
    usage: Load and install all dependencies.
    cmd: |
      npm install -g angular-cli typings
      cd default
      # There may be some leftover typings and npm modules, so delete the folders.
      rm -rf node_modules typings
      npm install
      typings install
  deps-backend:
    usage: Load and install all backend dependencies.
    cmd: |
      cd backend &&
      ahoy pip-install -- -r requirements.txt
  frontend-build:
    cmd: cd default && npm run build -- {{args}}
    usage: Build all of the files necessary to serve the site into the /dist folder.
  frontend-build-watch:
    usage: build the frontend files.
    cmd: ahoy frontend-build -- --watch=true
  test:
    cmd: |
      set -e
      cd default &&
      if [ $CIRCLE_TEST_REPORTS ]; then
        echo '> Adding junit output to $CIRCLE_TEST_REPORTS'
        export JUNIT_DIR=$CIRCLE_TEST_REPORTS
        FLAGS='--reporters=junit,progress'
      fi
      npm test $FLAGS
      npm run lint
    usage: Run the frontend unit tests.
